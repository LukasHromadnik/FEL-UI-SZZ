# Randomized Sampling-based Motion Planning Methods

## Probabilistic Roadmaps

A discrete representation of the continuous $\mathcal{C}$-space generated by randomly sampled configurations in $\mathcal{C}$-free that are connected into a graph.

* **Nodes** of the graph represent admissible coonfigurations of the robot.
* **Edges** represent a feasible path (trajectory) between the particular configurations.

Strategies:

* **Multi-query**: generate a single roadmap that is then used for repeated planning queries
* **Single-query**: for each planning problem it constructs a new roadmap to characterize the subspace of $\mathcal{C}$-space that is relevant to the problem.

## PRM Construction

1. Sample $n$ points in $\mathcal{C}$-free
2. Connect the random configurations using a local planner
3. Connect start and goal configurations with the PRM
4. Use the graph search to find the path

More practical implementation is

* Connect nodes in radius $\rho$
* Local planner tests collision up to selected resolution $\delta$

## Path Planning Problem Formulation

Path planning problem is defined by a triplet $\mathcal{P} = (\mathcal{C}_{free}, q_{init}, \mathcal{Q}_{goal})$ where

* $\mathcal{C}_{free} = cl(\mathcal{C} \setminus \mathcal{C}_{obs}), \mathcal{C} = (0, 1)^d$ for $d \in \mathbb{N}, d \geq 2$,
* $q_{init} \in \mathcal{C}_{free}$ is the initial configuration,
* $\mathcal{Q}_{goal}$ is the goal region defined as an open subspace of $\mathcal{C}_{free}$

Function $\pi: [0, 1] \to \mathbb{R}^d$ of bounded variation is called

* **path** it it is continuous,
* **collision-free path** if it is a path and $\pi(\tau) \in \mathcal{C}_{free}$ for $\tau \in [0, 1]$,
* **feasible** if it is a collision-free path and $\pi(0) = q_{init}$ and $\pi(1) \in cl(\mathcal{Q}_{goal})$

## Probabilistic Completeness

We need **robustly feasible path planning problem** $(\mathcal{C}_{free}, q_{init}, \mathcal{Q}_{goal})$.

* $q \in \mathcal{C}_{free}$ is **$\delta$-interior state of** $\mathcal{C}_{free}$ if the closed ball of radius $\delta$ centered at $q$ lies entirely inside $\mathcal{C}_{free}$.
* $\delta$-interior of $\mathcal{C}_{free}$ is $\mathrm{int}_\delta(\mathcal{C}_{free}) = \{ q \in \mathcal{C}_{free} \ | \ \mathbb{B}_{/,\delta} \subseteq \mathcal{C}_{free}\}$
* A collision free path $\pi$ has **strong $\delta$-clearance** if $\pi$ lies entirely inside $\mathrm{int}_\delta(\mathcal{C}_{free})$
* Planning problem is **robustly feasible** if a solution exists and it is a feasible path with *strong $\delta$-clearance*, for $\delta > 0$.

An algorithm $\mathcal{A}$ is **probabilistically complete** if for any robustly feasible path planning problem $\mathcal{P} = (\mathcal{C}_{free}, q_{init}, \mathcal{Q}_{goal})$
$$\lim_{n \to \infty} Pr(\mathcal{A} \text{ returns a solution to } \mathcal{P}) = 1.$$

## Asymptotic Optimality

* Function $\phi: [0, 1] \to \mathcal{C}_{free}$ is called **homotopy**, if $\phi(0) = \pi_1$ and $\phi(1) = \pi_2$ and $\phi(\tau)$ is collision-free path for all $\tau \in [0, 1]$.
* A collision-free path $\pi_1$ is **homotopic** to $\pi_2$ if there exists homotopy function $\phi$.
* A collision-free path $\pi: [0, s] \to \mathcal{C}_{free}$ has **weak $\delta$-clearance** if there exists a path $\pi'$ that has **strong $\delta$-clearance** and homotopy $\phi$ with $\phi(0) = \pi, \phi(1) = \pi'$ and for all $\alpha \in (0, 1]$ there exists $\delta_\alpha > 0$ such that $\phi(\alpha)$ has strong $\delta$-clearance. Weak $\delta$-clearance does not required points along a path to be at least a distance $\delta$ from obstacles.
* A collision-free path $\pi^*$ is **robustly optimal solution** if it has *weak $\delta$-clearance* and for any sequence of collision free paths $\{ \pi_n \}_{n \in \mathbb{N}}, \pi_n \in \mathcal{C}_{free}$ such that $\lim_{n \to \infty} \pi_n = \pi^*, \lim_{n \to \infty} c(\pi_n) = c(\pi^*)$.

An algorithm $\mathcal{A}$ is **asymptotically optimal** if for any path planning problem $\mathcal{P} = (\mathcal{C}_{free}, q_{init}, \mathcal{Q}_{goal})$ and cost function $c$ that admit a robust optimal solution with the finite cost $c^*$
$$Pr\left(\left\{\lim_{i \to \infty} Y_i^\mathcal{A} = c^* \right\}\right) = 1.$$
$Y_i^\mathcal{A}$ is the extended random variable corresponsding to the minimum cost solution included in the graph returns by $\mathcal{A}$ at the end of the iteration $i$.

sPRM (simplified PRM) is probabilistically complete and asymptotically optimal.

There is a main issue with randomized sampling-based approaches and that are narrow passages. We can solve this by choosing a better sampling strategy.

## Rapidly Exploring Random Tree (RRT)

Single-query algorithm that incrementally builds a graph (tree) towards the goal area.

1. Start with initial configuration $q_0$, which is a root of the constructed graph (tree).
2. Generate a new random configuration $q_{new}$ in $\mathcal{C}_{free}$.
3. Find the closest node $q_{near}$ to $q_{new}$ in the tree.
4. Extend $q_{near}$ towards $q_{new}$ (extend the tree by a small step).
5. Go to 2, until the tree is within a sufficient distance from the goal configuration.

Time complexity is $\mathcal{O}(n^2)$.

## Rapidly-exploring Random Graph (RRG)

At each iteration, RRG tries to connect new sample to all vertices in the $r_n$ ball centered at it. The connection radius decreases with $n$.

It's probabilistically complete and asymptotically optimal. Time complexity is $\mathcal{O}(\log n)$.

## Other Variants of the Optimal Motion Planning

* PRM\star follows the standard PRM algorithm where connections are attempted between roadmap vertices that are within the connection radius $r$ as the function of $n$.
* RRT\star is a modification of the RRG, where cycles are avoided. It's basically the RRG with "rerouting" the tree when a better path is discovered.

Algorithm        Probabilistic Completeness Asymptotic Optimality
---              ---                        ---
PRM              \checkmark                 $\times$
sPRM             \checkmark                 \checkmark
$k$-nearest sPRM $\times$                   $\times$
RRT              \checkmark                 $\times$
RRG              \checkmark                 \checkmark
PRM\star         \checkmark                 \checkmark
RRT\star         \checkmark                 \checkmark

## Improved Sampling-based Motion Planners

Although asymptotically optimal sampling-based motion planners such as RRT\star or RRG may provied high-quality or even optimal solutions of the complex problem, their performance in simple, e.g. 2D scenarios, is relatively poor.

The general idea of improvements is based on **informing** the sampling process.

### Informed RRT\star

* Use Euclidean distance as an admissible heuristic
* Having a feasible solution, the sampling continues inside the ellipse

### Batch Informed Trees (BIT\star)

* Batches of samples â€“ a new batch starts with denser implicit RGG (Random Geometric Graph)

### Regionally Accelerated BIT\star (RABIT\star)

Uses local optimizer to exploit obstacle informaction and improve a global search. The initial straight-line edge is given to a local optimizer which uses information about obstacles to find a local optima between the specified states. If this edge is collision-free, it is added to the tree and its potential outgoing edges are added to the queue.
